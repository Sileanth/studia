effect State =
  { put : Int  => Unit
  ; get : Unit => Int
  }

let with_state = fn f =>
  handle f () with
  | return x   => fn _ => x
  | put n      => fn _ => resume () n
  | get () / r => fn n => r n n
  end

let _ =
  with_state (fn () =>
    let _ = put 42 in
    let _ = put (readInt ()) in
    let _ = printInt (get ()) in
    get ()
  ) 69
